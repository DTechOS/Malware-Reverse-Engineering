import os
import pefile
from pathlib import Path
import pathlib
import ntpath

rootdir = '/Windows/SysWOW64'
for subdir, dirs, files in os.walk(rootdir):
    for filename in files:
      try:
        if filename.endswith(".dll"):
           paths = os.path.join(subdir,filename)
           full_path = paths.replace(ntpath.sep, pathlib.posixpath.sep) # converts windows into unix paths to be passed into pefile
           pe = pefile.PE(full_path)
           exports = [(exp.name) for exp in pe.DIRECTORY_ENTRY_EXPORT.symbols]
           print(filename, ":", exports)
      except:
        #print("failed to load file {}".format(filename))
        continue

        
  #run crc32 on exports      
#for i in export_list:
 # t = zlib.crc32(i)
  #xor = t ^ xor_key
  #final = hex(xor)
  #print(final)
  #if final in api_list:
   # print(final, i)

# add list of hashed api names collected from Dridex
#api_list = []
